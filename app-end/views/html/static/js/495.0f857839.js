"use strict";(self["webpackChunkMatsuzaka"]=self["webpackChunkMatsuzaka"]||[]).push([[495],{3495:function(e,t,s){s.r(t),s.d(t,{default:function(){return N}});var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("ChatInfo"),s("MsgIpt")],1)},i=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"infoBox",staticClass:"infoBox"},[e.info.length?n("div",{staticClass:"infoItemBox"},[n("span",{staticClass:"infoLengths"},[e._v("消息数: "+e._s(e.info.length))]),e._l(e.info,(function(t){return n("div",{class:e.isBox(t,"info")},[n("span",{class:e.isBox(t,"user")},[n("img",{staticClass:"userImgRight",attrs:{src:s(3329)}}),n("p",{staticClass:"userNameRight"},[e._v(" "+e._s(" 可恶的网友 - "+t.userCookie.slice(8))+" ")])]),n("span",{ref:"msg",refInFor:!0,class:e.isBox(t,"msg")},["img"==t.type?n("span",[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.$API.File.getFileUrl+t.userMsgInfo,expression:"$API.File.getFileUrl + infoItem.userMsgInfo"}],staticClass:"infoImg",attrs:{title:"**发生了意外错误**"},on:{click:function(s){return e.imageEvent(t)}}})]):n("span",{staticClass:"userMsgInfo"},[e._v(e._s(t.userMsgInfo))]),n("span",{staticClass:"time"},[e._v("Time: "+e._s(e.timeFormat(t.userMsgDate)))])])])}))],2):e._e(),e.imgShow.show?n("div",{staticClass:"imgShow",on:{click:function(t){return e.shotImg()}}},[n("img",{ref:"bigImg",staticClass:"bigImg",attrs:{src:e.imgShow.imgUrl,title:"**发生了意外错误**"}})]):e._e(),e.info.length?e._e():n("div",[e._m(0)])])},r=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flexbox"},[s("div",[s("div",{staticClass:"load"})])])}],a=s(6198);function c(e){var t,s,n,i,o=document.querySelector(e);function r(e){if(1===e.touches.length){var r=e.touches[0],a=Number(r.pageX),c=Number(r.pageY);t=o.offsetLeft,s=o.offsetTop,n=a-t,i=c-s}}var a=0,c=1,l=!1;function u(e){if(e.preventDefault(),1!==e.touches.length||l){if(2===e.touches.length){var t,s=e.touches[0],r=e.touches[1],u=s.pageX,f=s.pageY,m=r.pageX,h=r.pageY,g=Math.sqrt(Math.pow(m-u,2)+Math.pow(h-f,2));console.log(u,m,f,h),g>a&&g-a>3?(c<=5&&(c+=.15),o.style.transition="none",o.style.transform="translate(-50%, -50%) scale(".concat(c,")")):g<a&&g-a<-3&&(c>=.4&&(c-=.15),o.style.transition="none",o.style.transform="translate(-50%, -50%) scale(".concat(c,")")),a=Math.sqrt(Math.pow(m-u,2)+Math.pow(h-f,2)),l=!0,l&&(clearTimeout(t),t||(t=setTimeout((function(){l=!1,t=null}),500)))}}else{var p=e.touches[0],d=Number(p.pageX),v=Number(p.pageY);o.style.left=d-n+"px",o.style.top=v-i+"px",o.style.transition="none"}}function f(e){var t=o.style.transform&&o.style.transform.split(" ")[2].slice(6).slice(0,-1);(Number(t)<=1.2||""==o.style.transform)&&(o.offsetLeft+o.offsetWidth/2>window.innerWidth||o.offsetTop+o.offsetHeight/2>window.innerHeight||o.offsetLeft-o.offsetWidth/2<0||o.offsetTop-o.offsetHeight/2<0)&&(o.style.left="50%",o.style.top="50%",o.style.transition="all 0.2s"),e||e()}o.addEventListener("touchstart",r,!1),o.addEventListener("touchmove",u,!0),o.addEventListener("touchend",f,!1)}var l=s(9431),u={name:"chatInfo",data:function(){return{info:[],infoMarginTop:[],imgShow:{show:!1,imgUrl:""}}},created:function(){var e=this;return(0,a.Z)(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.timeFormat=l.i$,e.$bus.$on("emitInfoMsg",(function(t){e.info.push(t)})),t.next=4,e.$API.Chat.getMsgInfo();case 4:s=t.sent,200===s.status&&(e.info=s.data,setTimeout((function(){e.$bus.$emit("elDisabled"),e.$scrollBottom(),e.$bus.$emit("showReference")}),200));case 6:case"end":return t.stop()}}),t)})))()},methods:{isBox:function(e,t){var s=localStorage.getItem("userCookie");return s==e.userCookie?"".concat(t,"Left"):"".concat(t,"Right")},imageEvent:function(e){this.imgShow.show=!0,this.imgShow.imgUrl=this.$API.File.getFileUrl+e.userMsgInfo,this.$nextTick((function(){c(".bigImg")}))},shotImg:function(){this.imgShow.show=!1}}},f=u,m=s(1001),h=(0,m.Z)(f,o,r,!1,null,"4a2a7677",null),g=h.exports,p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"msgIptMain",staticClass:"main"},[s("shearPlate"),s("div",{staticClass:"cont"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.IptMsg,expression:"IptMsg"}],ref:"msgIpt",staticClass:"msgIpt",attrs:{type:"text",placeholder:e.userName,autocapitalize:"off",disabled:""},domProps:{value:e.IptMsg},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.CommitMsg.apply(null,arguments)},input:function(t){t.target.composing||(e.IptMsg=t.target.value)}}}),s("el-upload",{staticClass:"el-upload",attrs:{action:e.$API.File.uploadFile,"before-upload":e.beforeUpload,"on-success":e.upload}},[s("i",{staticClass:"pic iconfont icon-tupian"})])],1),s("button",{ref:"msgCommit",staticClass:"msgCommit",attrs:{disabled:""},on:{click:e.CommitMsg}},[e._v(" 发送 ")])],1)},d=[],v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.showReference?s("div",{directives:[{name:"show",rawName:"v-show",value:e.isReferenceValue,expression:"isReferenceValue"}],ref:"reference",staticClass:"i-x",on:{click:e.toValue}},[s("div",{staticClass:"shearPlateContainer"},[e._v('是否输入 "'+e._s(e.value)+'"')])]):e._e()},w=[],I={name:"Header",data:function(){return{showReference:!0,value:"",isReferenceValue:!1}},props:{showTimer:{type:Number,default:5},showDirection:{type:String,default:"left"}},mounted:function(){var e=this;this.$bus.$on("showReference",(function(){e.$refs.reference.style.display="block",e.show()})),this.getReference()},methods:{toValue:function(){this.$bus.$emit("ReferenceToValue",this.value),this.hide(0)},getReference:function(){var e=this,t=navigator.clipboard.readText();t.then((function(t){""!==t.trim()&&(e.value=t.trim()),e.isReference(t.trim())}))},isReference:function(e){localStorage.getItem("ReferenceValue")===this.value?this.showReference=!1:this.showReference=!0,localStorage.setItem("ReferenceValue",e)},hide:function(e){var t=this;this.$refs.reference.style[this.showDirection]="5px",setTimeout((function(){t.$refs.reference.style[t.showDirection]="-100vh",setTimeout((function(){t.showReference=!1}),500)}),e)},show:function(){var e=this;this.showReference=!0,this.$refs.reference.style[this.showDirection]="-100vh",setTimeout((function(){e.$refs.reference.style[e.showDirection]="5px",e.hide(8e3)}),100)}}},C=I,$=(0,m.Z)(C,v,w,!1,null,"4fd97189",null),y=$.exports,M={name:"msgIpt",data:function(){var e;return{IptMsg:"",userName:localStorage.getItem("userCookie")?null===(e=localStorage.getItem("userCookie"))||void 0===e?void 0:e.slice(8):"请输入.."}},components:{shearPlate:y},created:function(){var e=this;this.ws=new WebSocket("wss://matsuzaka.top:9999"),this.ws.onmessage=function(t){var s=JSON.parse(t.data);s.userMsgInfo?(e.$bus.$emit("emitInfoMsg",s),e.$isMessage(s.userMsgInfo)):localStorage.setItem("userCookie",s.userCookie)},this.$bus.$on("destroySocket",(function(){e.ws.close()}))},mounted:function(){var e=this;this.$bus.$on("elDisabled",(function(){e.$refs.msgIpt.disabled=!1,e.$refs.msgCommit.disabled=!1,e.$refs.msgIptMain.style.bottom="0px"})),this.$bus.$on("ReferenceToValue",(function(t){e.IptMsg=t}))},methods:{CommitMsg:function(){this.IptMsg.length>200?this.$message.error("超出字数限制"):(this.ws.send(JSON.stringify({userMsg:this.IptMsg,userCookie:localStorage.getItem("userCookie")})),this.IptMsg="",this.$scrollBottom())},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type||"image/gif"===e.type,s=e.size/1024/1024<3;return t&&s||this.$message.error("图片格式暂只支持: jpg / png / gif, 且大小不超过3M"),t&&s},upload:function(e){var t=this;return(0,a.Z)(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.ws.send(JSON.stringify({userMsg:e.ran+e.fileName,userMsgDate:0,userCookie:localStorage.getItem("userCookie"),type:"img"}));case 1:case"end":return s.stop()}}),s)})))()}}},b=M,k=(0,m.Z)(b,p,d,!1,null,"7fbe88a0",null),x=k.exports,_={name:"chat",components:{ChatInfo:g,MsgIpt:x},activated:function(){this.$scrollBottom()}},R=_,S=(0,m.Z)(R,n,i,!1,null,null,null),N=S.exports},3329:function(e,t,s){e.exports=s.p+"static/img/userImg.d46277a4.png"},6198:function(e,t,s){function n(e,t,s,n,i,o,r){try{var a=e[o](r),c=a.value}catch(l){return void s(l)}a.done?t(c):Promise.resolve(c).then(n,i)}function i(e){return function(){var t=this,s=arguments;return new Promise((function(i,o){var r=e.apply(t,s);function a(e){n(r,i,o,a,c,"next",e)}function c(e){n(r,i,o,a,c,"throw",e)}a(void 0)}))}}s.d(t,{Z:function(){return i}})}}]);