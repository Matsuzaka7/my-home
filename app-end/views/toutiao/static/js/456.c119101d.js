"use strict";(self["webpackChunkheadline"]=self["webpackChunkheadline"]||[]).push([[456],{6919:function(t,e,n){n.r(e),n.d(e,{default:function(){return O}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home-container"},[s("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[s("div",{staticClass:"logo-container",attrs:{slot:"left",to:{name:"my"}},slot:"left"},[s("img",{staticClass:"logo",attrs:{src:n(6949),alt:""}}),s("span",[t._v("头条")])]),s("van-button",{staticClass:"search-btn",attrs:{slot:"right",type:"info",size:"small",round:"",icon:"search"},on:{click:function(e){return t.$router.push("/search")}},slot:"right"},[t._v("搜索")])],1),s("van-tabs",{staticClass:"channel-tabs",attrs:{swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return s("van-tab",{key:t.id,attrs:{title:t.name}},[s("article-list",{attrs:{channel:t}})],1)})),s("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),s("div",{attrs:{slot:"nav-right"},on:{click:function(e){t.showChannelEdit=!0}},slot:"nav-right"},[s("i",{staticClass:"toutiao toutiao-gengduo more-btn"})])],2),s("van-popup",{style:{height:"100%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.showChannelEdit,callback:function(e){t.showChannelEdit=e},expression:"showChannelEdit"}},[s("channel-edit",{attrs:{channels:t.channels,active:t.active},on:{"update-active":t.changeActive}})],1)],1)},a=[],i=n(5155),l=n(4140),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"article-list",staticClass:"article-list"},[n("van-pull-refresh",{attrs:{"success-text":"刷新成功","success-duration":"600"},on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[n("van-list",{attrs:{"immediate-check":!1,finished:t.finished,"finished-text":"没有更多了, o(╥﹏╥)o",error:t.error,"error-text":"请求失败 , 点击重新加载"},on:{load:t.onLoad,"update:error":function(e){t.error=e},refresh:t.onRefresh},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,e){return n("ArticleItem",{key:e,attrs:{article:t}})})),1)],1)],1)},o=[],c=n(1767),h=n(3434),d=n(2009),u={props:{channel:{type:Object,required:!0}},components:{ArticleItem:h.Z},name:"ArticleList",data(){return{list:[],loading:!1,finished:!1,error:!1,refreshing:!1,timestamp:null,scrollTop:0}},methods:{async onLoad(){try{const{data:t}=await(0,c.fq)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now()}),{results:e}=t.data;this.refreshing&&(this.list=[]),this.list.push(...e),this.loading=!1,this.refreshing=!1,e.length?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},onRefresh(){this.loading=!0,this.onLoad()}},created(){this.onLoad()},mounted(){const t=this.$refs["article-list"];t.onscroll=(0,d.debounce)((()=>{this.scrollTop=t.scrollTop}),50)},activated(){this.$refs["article-list"].scrollTop=this.scrollTop}},m=u,v=n(1001),f=(0,v.Z)(m,r,o,!1,null,"1b124e3b",null),C=f.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"channel-edit"},[n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),n("van-button",{staticClass:"edit-btn",attrs:{type:"danger",size:"mini",round:"",plain:""},on:{click:function(e){t.showEditMyChannels=!t.showEditMyChannels}}},[t._v(t._s(t.showEditMyChannels?"完成":"编辑"))])],1),n("van-grid",{attrs:{gutter:10}},t._l(t.myChannels,(function(e,s){return n("van-grid-item",{key:s,staticClass:"grid-item",attrs:{text:e.name},on:{click:function(n){return t.onMyChannelClick(e,s)}}},[n("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.showEditMyChannels&&t.myChannels[0].id!==e.id,expression:"showEditMyChannels && myChannels[0].id !== item.id"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),n("span",{staticClass:"text",class:{active:s===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(e.name))])],1)})),1),n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("所有频道")])]),n("van-grid",{attrs:{direction:"horizontal",gutter:10}},t._l(t.filterChannels,(function(e,s){return n("van-grid-item",{key:s,staticClass:"grid-item",attrs:{icon:"plus",text:e.name},on:{click:function(n){return t.onAddChannel(e)}}})})),1)],1)},g=[],y=n(8029);const _=()=>(0,y.Z)({method:"GET",url:"/v1_0/channels"}),E=t=>(0,y.Z)({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}}),b=t=>(0,y.Z)({method:"DELETE",url:`/v1_0/user/channels/${t}`});var w=n(1718),k={props:{channels:{type:Array,required:!0},active:{type:Number,required:!0}},name:"ChannelEdit",data(){return{myChannels:this.channels,Allchannels:[],showEditMyChannels:!1}},methods:{async loadAllChannels(){try{const{data:t}=await _();this.Allchannels=t.data.channels}catch(t){this.$toast("获取失败 , 请重试 !")}},async loadMyChannels(){if(this.user)this.myChannels=this.channels;else{const t=await(0,w.rV)("TOUTIAO_Channels");this.myChannels=t}},async onAddChannel(t){if(this.myChannels.push(t),this.user)try{E({id:t.id,seq:this.myChannels.length})}catch(e){this.$toast("操作失败 , 请重试 !")}else(0,w.LS)("TOUTIAO_Channels",this.myChannels)},async onMyChannelClick(t,e){if(this.showEditMyChannels){if(this.myChannels[0].id===t.id)return;this.myChannels.splice(e,1),e<=this.active&&this.$emit("update-active",this.active-1,!0),this.deleteChannel(t)}else this.$emit("update-active",e)},async deleteChannel(t){if(this.user)try{b(t.id)}catch(e){this.$toast("操作失败 , 请重试 !")}else(0,w.LS)("TOUTIAO_Channels",this.myChannels)}},created(){this.loadAllChannels()},computed:{...(0,l.rn)(["user"]),filterChannels(){return this.Allchannels.filter((t=>!this.channels.find((e=>e.id===t.id))))}}},T=k,x=(0,v.Z)(T,p,g,!1,null,"71872158",null),A=x.exports,$={name:"HomeIndex",components:{ArticleList:C,ChannelEdit:A},data(){return{active:0,channels:[],showChannelEdit:!1}},created(){this.loadChannels()},methods:{async loadChannels(){try{let t=[];if(this.user){const{data:e}=await(0,i.Ci)();t=e.data.channels}else{const e=(0,w.rV)("TOUTIAO_Channels");if(e)t=e;else{const{data:e}=await(0,i.Ci)();t=e.data.channels}}this.channels=t}catch(t){this.$toast(t)}},changeActive(t,e=!1){this.active=t,this.showChannelEdit=e}},computed:{...(0,l.rn)(["user"])}},Z=$,L=(0,v.Z)(Z,s,a,!1,null,"214d0a9d",null),O=L.exports},1767:function(t,e,n){n.d(e,{BH:function(){return c},Vr:function(){return i},_Y:function(){return l},cS:function(){return r},dE:function(){return o},fq:function(){return a}});var s=n(8029);const a=t=>(0,s.Z)({method:"GET",url:"/v1_0/articles",params:t}),i=t=>(0,s.Z)({method:"GET",url:`/v1_0/articles/${t}`}),l=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),r=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),o=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),c=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`})},6949:function(t,e,n){t.exports=n.p+"static/img/logo.f5c593b4.png"}}]);