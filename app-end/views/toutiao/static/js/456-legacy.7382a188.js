(self["webpackChunkheadline"]=self["webpackChunkheadline"]||[]).push([[456],{6919:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return D}});var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"home-container"},[r("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[r("div",{staticClass:"logo-container",attrs:{slot:"left",to:{name:"my"}},slot:"left"},[r("img",{staticClass:"logo",attrs:{src:n(6949),alt:""}}),r("span",[t._v("头条")])]),r("van-button",{staticClass:"search-btn",attrs:{slot:"right",type:"info",size:"small",round:"",icon:"search"},on:{click:function(e){return t.$router.push("/search")}},slot:"right"},[t._v("搜索")])],1),r("van-tabs",{staticClass:"channel-tabs",attrs:{swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return r("van-tab",{key:t.id,attrs:{title:t.name}},[r("article-list",{attrs:{channel:t}})],1)})),r("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),r("div",{attrs:{slot:"nav-right"},on:{click:function(e){t.showChannelEdit=!0}},slot:"nav-right"},[r("i",{staticClass:"toutiao toutiao-gengduo more-btn"})])],2),r("van-popup",{style:{height:"100%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.showChannelEdit,callback:function(e){t.showChannelEdit=e},expression:"showChannelEdit"}},[r("channel-edit",{attrs:{channels:t.channels,active:t.active},on:{"update-active":t.changeActive}})],1)],1)},a=[],s=n(2173),i=n(2646),c=n(2381),l=n(5155),o=n(4140),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"article-list",staticClass:"article-list"},[n("van-pull-refresh",{attrs:{"success-text":"刷新成功","success-duration":"600"},on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[n("van-list",{attrs:{"immediate-check":!1,finished:t.finished,"finished-text":"没有更多了, o(╥﹏╥)o",error:t.error,"error-text":"请求失败 , 点击重新加载"},on:{load:t.onLoad,"update:error":function(e){t.error=e},refresh:t.onRefresh},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,e){return n("ArticleItem",{key:e,attrs:{article:t}})})),1)],1)],1)},h=[],d=n(3561),f=n(1767),v=n(3434),p=n(2009),m={props:{channel:{type:Object,required:!0}},components:{ArticleItem:v.Z},name:"ArticleList",data:function(){return{list:[],loading:!1,finished:!1,error:!1,refreshing:!1,timestamp:null,scrollTop:0}},methods:{onLoad:function(){var t=this;return(0,c.Z)((0,i.Z)().mark((function e(){var n,r,a,s;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.fq)({channel_id:t.channel.id,timestamp:t.timestamp||Date.now()});case 3:r=e.sent,a=r.data,s=a.data.results,t.refreshing&&(t.list=[]),(n=t.list).push.apply(n,(0,d.Z)(s)),t.loading=!1,t.refreshing=!1,s.length?t.timestamp=a.data.pre_timestamp:t.finished=!0,e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](0),t.error=!0,t.loading=!1;case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))()},onRefresh:function(){this.loading=!0,this.onLoad()}},created:function(){this.onLoad()},mounted:function(){var t=this,e=this.$refs["article-list"];e.onscroll=(0,p.debounce)((function(){t.scrollTop=e.scrollTop}),50)},activated:function(){this.$refs["article-list"].scrollTop=this.scrollTop}},C=m,b=n(1001),g=(0,b.Z)(C,u,h,!1,null,"1b124e3b",null),w=g.exports,y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"channel-edit"},[n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),n("van-button",{staticClass:"edit-btn",attrs:{type:"danger",size:"mini",round:"",plain:""},on:{click:function(e){t.showEditMyChannels=!t.showEditMyChannels}}},[t._v(t._s(t.showEditMyChannels?"完成":"编辑"))])],1),n("van-grid",{attrs:{gutter:10}},t._l(t.myChannels,(function(e,r){return n("van-grid-item",{key:r,staticClass:"grid-item",attrs:{text:e.name},on:{click:function(n){return t.onMyChannelClick(e,r)}}},[n("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.showEditMyChannels&&t.myChannels[0].id!==e.id,expression:"showEditMyChannels && myChannels[0].id !== item.id"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),n("span",{staticClass:"text",class:{active:r===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(e.name))])],1)})),1),n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("所有频道")])]),n("van-grid",{attrs:{direction:"horizontal",gutter:10}},t._l(t.filterChannels,(function(e,r){return n("van-grid-item",{key:r,staticClass:"grid-item",attrs:{icon:"plus",text:e.name},on:{click:function(n){return t.onAddChannel(e)}}})})),1)],1)},x=[],k=(n(9653),n(561),n(7327),n(1539),n(9826),n(8029)),Z=function(){return(0,k.Z)({method:"GET",url:"/v1_0/channels"})},_=function(t){return(0,k.Z)({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}})},E=function(t){return(0,k.Z)({method:"DELETE",url:"/v1_0/user/channels/".concat(t)})},O=n(1718),T={props:{channels:{type:Array,required:!0},active:{type:Number,required:!0}},name:"ChannelEdit",data:function(){return{myChannels:this.channels,Allchannels:[],showEditMyChannels:!1}},methods:{loadAllChannels:function(){var t=this;return(0,c.Z)((0,i.Z)().mark((function e(){var n,r;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z();case 3:n=e.sent,r=n.data,t.Allchannels=r.data.channels,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$toast("获取失败 , 请重试 !");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loadMyChannels:function(){var t=this;return(0,c.Z)((0,i.Z)().mark((function e(){var n;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.user){e.next=4;break}t.myChannels=t.channels,e.next=8;break;case 4:return e.next=6,(0,O.rV)("TOUTIAO_Channels");case 6:n=e.sent,t.myChannels=n;case 8:case"end":return e.stop()}}),e)})))()},onAddChannel:function(t){var e=this;return(0,c.Z)((0,i.Z)().mark((function n(){return(0,i.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.myChannels.push(t),e.user)try{_({id:t.id,seq:e.myChannels.length})}catch(r){e.$toast("操作失败 , 请重试 !")}else(0,O.LS)("TOUTIAO_Channels",e.myChannels);case 2:case"end":return n.stop()}}),n)})))()},onMyChannelClick:function(t,e){var n=this;return(0,c.Z)((0,i.Z)().mark((function r(){return(0,i.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.showEditMyChannels){r.next=8;break}if(n.myChannels[0].id!==t.id){r.next=3;break}return r.abrupt("return");case 3:n.myChannels.splice(e,1),e<=n.active&&n.$emit("update-active",n.active-1,!0),n.deleteChannel(t),r.next=9;break;case 8:n.$emit("update-active",e);case 9:case"end":return r.stop()}}),r)})))()},deleteChannel:function(t){var e=this;return(0,c.Z)((0,i.Z)().mark((function n(){return(0,i.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.user)try{E(t.id)}catch(r){e.$toast("操作失败 , 请重试 !")}else(0,O.LS)("TOUTIAO_Channels",e.myChannels);case 1:case"end":return n.stop()}}),n)})))()}},created:function(){this.loadAllChannels()},computed:(0,s.Z)((0,s.Z)({},(0,o.rn)(["user"])),{},{filterChannels:function(){var t=this;return this.Allchannels.filter((function(e){return!t.channels.find((function(t){return t.id===e.id}))}))}})},A=T,j=(0,b.Z)(A,y,x,!1,null,"71872158",null),P=j.exports,$={name:"HomeIndex",components:{ArticleList:w,ChannelEdit:P},data:function(){return{active:0,channels:[],showChannelEdit:!1}},created:function(){this.loadChannels()},methods:{loadChannels:function(){var t=this;return(0,c.Z)((0,i.Z)().mark((function e(){var n,r,a,s,c,o;return(0,i.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,n=[],!t.user){e.next=10;break}return e.next=5,(0,l.Ci)();case 5:r=e.sent,a=r.data,n=a.data.channels,e.next=20;break;case 10:if(s=(0,O.rV)("TOUTIAO_Channels"),!s){e.next=15;break}n=s,e.next=20;break;case 15:return e.next=17,(0,l.Ci)();case 17:c=e.sent,o=c.data,n=o.data.channels;case 20:t.channels=n,e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](0),t.$toast(e.t0);case 26:case"end":return e.stop()}}),e,null,[[0,23]])})))()},changeActive:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.active=t,this.showChannelEdit=e}},computed:(0,s.Z)({},(0,o.rn)(["user"]))},L=$,M=(0,b.Z)(L,r,a,!1,null,"214d0a9d",null),D=M.exports},9337:function(t,e,n){var r=n(2109),a=n(9781),s=n(3887),i=n(5656),c=n(1236),l=n(6135);r({target:"Object",stat:!0,sham:!a},{getOwnPropertyDescriptors:function(t){var e,n,r=i(t),a=c.f,o=s(r),u={},h=0;while(o.length>h)n=a(r,e=o[h++]),void 0!==n&&l(u,e,n);return u}})},1767:function(t,e,n){"use strict";n.d(e,{BH:function(){return o},Vr:function(){return s},_Y:function(){return i},cS:function(){return c},dE:function(){return l},fq:function(){return a}});var r=n(8029),a=function(t){return(0,r.Z)({method:"GET",url:"/v1_0/articles",params:t})},s=function(t){return(0,r.Z)({method:"GET",url:"/v1_0/articles/".concat(t)})},i=function(t){return(0,r.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}})},c=function(t){return(0,r.Z)({method:"DELETE",url:"/v1_0/article/collections/".concat(t)})},l=function(t){return(0,r.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}})},o=function(t){return(0,r.Z)({method:"DELETE",url:"/v1_0/article/likings/".concat(t)})}},6949:function(t,e,n){"use strict";t.exports=n.p+"static/img/logo.f5c593b4.png"},2173:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});n(7941),n(2526),n(7327),n(1539),n(5003),n(4747),n(9337);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}}}]);