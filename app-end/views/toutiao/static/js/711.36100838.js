"use strict";(self["webpackChunkheadline"]=self["webpackChunkheadline"]||[]).push([[711],{6711:function(e,t,s){s.r(t),s.d(t,{default:function(){return L}});var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-container"},[s("van-nav-bar",{staticClass:"searchNav",attrs:{"right-text":"搜索","left-arrow":""},on:{"click-left":function(t){return e.$router.back()},"click-right":function(t){return e.onSearch(e.searchText)}}},[s("van-search",{attrs:{slot:"title",background:"#3395fc",placeholder:"请输入搜索关键词",shape:"round"},on:{focus:function(t){e.isShowSearchRes=!1},search:e.onSearch},slot:"title",model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),e.isShowSearchRes?s("search-result",{attrs:{"search-text":e.searchText}}):e.searchText?s("search-suggestion",{attrs:{searchText:e.searchText},on:{onSearch:e.onSearch}}):s("search-history",{ref:"searchHistory",on:{onSearch:e.onSearch}})],1)},a=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-history"},[s("van-cell",{staticClass:"hostory-container",attrs:{title:"搜索历史"}},[e.isShowDel?s("span",{on:{click:e.delAllHistory}},[e._v("全部删除")]):e._e(),e.isShowDel?s("span",{on:{click:function(t){e.isShowDel=!1,e.isShowClear=!1}}},[e._v("完成")]):s("van-icon",{attrs:{name:"delete-o"},on:{click:function(t){e.isShowDel=!0,e.isShowClear=!0}}})],1),s("div",{staticClass:"history-list"},e._l(e.historyAll,(function(t,r){return s("span",{key:r,staticClass:"history-item",on:{click:function(s){return e.clickSearchHistory(t,r)}}},[e._v(e._s(t)),e.isShowClear?s("van-icon",{attrs:{slot:"icon",name:"close"},slot:"icon"}):e._e()],1)})),0)],1)},n=[],c=s(1718),o={name:"SearchHistory",data(){return{isShowDel:!1,historyAll:(0,c.rV)("his")||(0,c.LS)("his",[]),isShowClear:!1}},methods:{clickSearchHistory(e,t){this.isShowClear?(this.historyAll.splice(t,1),0===this.historyAll.length&&(this.isShowClear=!1,this.isShowDel=!1),(0,c.LS)("his",this.historyAll)):this.$emit("onSearch",e)},delAllHistory(){this.historyAll=[],this.isShowDel=!1,this.isShowClear=!1,(0,c.LS)("his",[])}}},h=o,l=s(1001),u=(0,l.Z)(h,i,n,!1,null,"fc220afc",null),d=u.exports,S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-suggestion"},[s("van-cell-group",e._l(e.searchSuggestions,(function(t,r){return s("van-cell",{key:r,attrs:{icon:"search"},on:{click:function(s){return e.$emit("onSearch",t)}}},[s("div",{attrs:{slot:"title"},domProps:{innerHTML:e._s(e.highlight(t))},slot:"title"})])})),1)],1)},g=[],f=s(8029);const p=e=>(0,f.Z)({method:"GET",url:"/v1_0/suggestion",params:{q:e}}),v=e=>(0,f.Z)({method:"GET",url:"/v1_0/search",params:e});var m=s(2009),x={props:["searchText"],name:"SearchSuggestion",data(){return{searchSuggestions:[]}},watch:{searchText:{handler:(0,m.debounce)((function(e){this.loadSearchSuggestions(e)}),300),immediate:!0}},methods:{async loadSearchSuggestions(e){try{const{data:t}=await p(e);this.searchSuggestions=t.data.options}catch(t){this.$toast("发生未知错误 , 请稍后再试!")}},highlight(e){const t=`<span class='active'>${this.searchText}</span>`,s=new RegExp(this.searchText,"gi");return e.replaceAll(s,t)}}},y=x,w=(0,l.Z)(y,S,g,!1,null,"3bbd1111",null),_=w.exports,k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search-result"},[s("van-list",{attrs:{finished:e.finished,"finished-text":"没有更多了",error:e.error,"err-text":"加载失败 , 请重试!"},on:{"update:error":function(t){e.error=t},load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.list,(function(e,t){return s("van-cell",{key:t,attrs:{title:e.title,"is-link":"",to:{name:"article",params:{articleId:e.art_id}}}})})),1)],1)},T=[],C={props:{searchText:{type:String,required:!0}},name:"SearchResult",data(){return{list:[],loading:!1,finished:!1,page:1,error:!1}},methods:{async onLoad(){try{const e={page:this.page,per_page:20,q:this.searchText},{data:t}=await v(e),s=t.data.results;this.list.push(...s),this.loading=!1,s.length?this.page++:this.finished=!0}catch(e){this.error=!0,this.loading=!1}}}},b=C,A=(0,l.Z)(b,k,T,!1,null,"3c54bbdd",null),$=A.exports,H={name:"SearchIndex",components:{SearchHistory:d,SearchSuggestion:_,SearchResult:$},data(){return{searchText:"",isShowSearchRes:!1}},methods:{onSearch(e=this.searchText){this.searchText=e,this.isShowSearchRes=!0;const t=(0,c.rV)("his"),s=t.some((t=>t===e));s||(t.unshift(e),(0,c.LS)("his",t))}}},D=H,E=(0,l.Z)(D,r,a,!1,null,"704e6c48",null),L=E.exports}}]);