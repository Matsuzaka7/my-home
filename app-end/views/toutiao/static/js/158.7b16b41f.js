"use strict";(self["webpackChunkheadline"]=self["webpackChunkheadline"]||[]).push([[158],{8456:function(t,e,s){s.d(e,{Z:function(){return u}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-button",{staticClass:"follow-btn",attrs:{type:t.value?"default":"info",size:"small",round:"",loading:t.followLoading},on:{click:t.onFollow}},[t._t("default",(function(){return[t._v(" "+t._s(t.value?"已关注":"关注")+" ")]}))],2)},i=[],o=s(5155),n={props:{value:{type:Boolean,required:!0},userId:{type:[Number,String,Object],required:!0}},name:"FollowUser",data(){return{followLoading:!1}},methods:{async onFollow(){this.followLoading=!0;try{this.value?(await(0,o.zM)(this.userId),this.$toast("取消关注")):(await(0,o.R3)(this.userId),this.$toast("关注成功")),this.$emit("input",!this.value)}catch(t){let e="发生未知错误 ! 请稍后重试";t.response&&400===t.response.status?e="你不能关注你自己!":t.response&&401===t.response.status&&(e="您尚未登录!"),this.$toast(e)}this.followLoading=!1}}},l=n,r=s(1001),c=(0,r.Z)(l,a,i,!1,null,"3bd8d9be",null),u=c.exports},1158:function(t,e,s){s.r(e),s.d(e,{default:function(){return R}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"article-container"},[s("van-nav-bar",{staticClass:"articleNav",attrs:{title:"文章详情","left-arrow":""},on:{"click-left":function(e){return t.$router.back()}}}),s("div",{staticClass:"main-wrap"},[t.loading?s("div",{staticClass:"loading-wrap"},[s("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("疯狂加载中...")])],1):t.article.title?s("div",{staticClass:"article-detail"},[s("h4",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),s("van-cell",{ref:"author",staticClass:"author user-cell",attrs:{center:"",border:!1}},[s("div",{staticClass:"base-info"},[s("van-image",{attrs:{round:"",width:"1rem",height:"1rem",fit:"cover",src:t.article.aut_photo}}),s("div",{staticClass:"text"},[s("p",{staticClass:"name"},[t._v(t._s(t.article.aut_name))]),s("p",{staticClass:"time"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]),s("FollowUser",{staticClass:"follow-btn",attrs:{userId:t.article.aut_id},model:{value:t.article.is_followed,callback:function(e){t.$set(t.article,"is_followed",e)},expression:"article.is_followed"}})],1)]),s("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),s("CommentList",{ref:"commentList",attrs:{source:t.article.art_id,data:t.commentList},model:{value:t.commentTotal,callback:function(e){t.commentTotal=e},expression:"commentTotal"}}),s("div",{staticClass:"article-footer"},[s("van-button",{staticClass:"onComment",attrs:{icon:"edit",type:"default"},on:{click:function(e){t.isPostShow=!0,t.onCommentList()}}},[t._v("写评论")]),s("van-icon",{attrs:{name:"comment-o",info:t.commentTotal,color:"#777"},on:{click:t.onCommentList}}),s("ArticleCollect",{staticClass:"btn-item",attrs:{articleId:t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),s("ArticleLike",{staticClass:"btn-item",attrs:{articleId:t.article.art_id},model:{value:t.article.attitude,callback:function(e){t.$set(t.article,"attitude",e)},expression:"article.attitude"}}),s("van-icon",{attrs:{name:"share-o",color:"#777777"},on:{click:function(e){return t.$toast("此功能暂未开放 ! ")}}})],1)],1):404===t.errStatus?s("div",{staticClass:"error-wrap"},[s("van-icon",{attrs:{name:"failure"}}),s("p",{staticClass:"text"},[t._v("该资源不存在或已删除!")])],1):s("div",{staticClass:"error-wrap"},[s("van-icon",{attrs:{name:"failure"}}),s("p",{staticClass:"text"},[t._v("内容加载失败!")]),s("van-button",{attrs:{type:"info"},on:{click:t.loadArticle}},[t._v("点击重试")])],1),s("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[s("CommentPost",{attrs:{target:t.article.art_id},on:{postSuccess:t.onPostSuccess}})],1)],1)],1)},i=[],o=s(1767),n=s(3984),l=s(8456),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-button",{class:{collected:t.value},attrs:{loading:t.loading,icon:t.value?"star":"star-o"},on:{click:t.onCollect}})},c=[],u={props:{value:{type:Boolean,required:!0},articleId:{type:[Number,String,Object],required:!0}},name:"ArticleCollect",data(){return{loading:!1}},methods:{async onCollect(){this.loading=!0;try{this.value?await(0,o.cS)(this.articleId):await(0,o._Y)(this.articleId),this.$emit("input",!this.value),this.$toast(this.value?"取消收藏":"收藏成功")}catch(t){let e="发生未知错误 ! 请稍后重试";t.response&&401===t.response.status&&(e="认证过期或未登录 请登录 !",this.$router.push("/login")),this.$toast(e)}this.loading=!1}}},m=u,d=s(1001),h=(0,d.Z)(m,r,c,!1,null,"6cf0c2fc",null),p=h.exports,f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-button",{class:{liked:1===t.value},attrs:{icon:1===t.value?"good-job":"good-job-o",loading:t.loading},on:{click:t.onLike}})},v=[],_={props:{value:{type:[Number,String,Object],required:!0},articleId:{type:[Number,String,Object],required:!0}},name:"ArticleLike",data(){return{loading:!1}},methods:{async onLike(){this.loading=!0;try{1===this.value?await(0,o.BH)(this.articleId):await(0,o.dE)(this.articleId),this.$emit("input",1===this.value?-1:1),this.$toast(1!==this.value?"点赞成功":"取消点赞")}catch(t){let e="发生未知错误 ! 请稍后重试";t.response&&401===t.response.status&&(e="认证过期或未登录 请登录 !",this.$router.push("/login")),this.$toast(e)}this.loading=!1}}},g=_,b=(0,d.Z)(g,f,v,!1,null,"3dcfe18e",null),C=b.exports,w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[s("h4",[t._v("全部评论 ("+t._s(t.total)+")")]),t._l(t.data,(function(t,e){return s("CommentItem",{key:e,attrs:{commentItem:t}})}))],2)],1)},k=[],$=s(8029);const y=t=>(0,$.Z)({method:"GET",url:"/v1_0/comments",params:t}),T=t=>(0,$.Z)({method:"POST",url:"/v1_0/comment/likings",data:t}),E=t=>(0,$.Z)({method:"DELETE",url:`/v1_0/comment/likings/${t}`}),Z=t=>(0,$.Z)({method:"POST",url:"/v1_0/comments",data:t});var I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-cell",{staticClass:"comment-item"},[s("van-image",{staticClass:"avtar",attrs:{slot:"icon",src:t.commentItem.aut_photo,round:"",fit:"cover"},slot:"icon"}),s("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"user-name"},[t._v(t._s(t.commentItem.aut_name))]),s("van-button",{staticClass:"like-btn",class:{liked:t.commentItem.is_liking},attrs:{size:"small",loading:t.loading,icon:t.commentItem.is_liking?"good-job":"good-job-o"},on:{click:function(e){return t.onCommentLike(t.commentItem)}}},[t._v(t._s(t.commentItem.like_count>0?t.commentItem.like_count:"赞"))])],1),s("div",{staticClass:"box",attrs:{slot:"label"},slot:"label"},[s("p",{staticClass:"comment-content"},[t._v(t._s(t.commentItem.content))]),s("div",{staticClass:"bottom-info"},[s("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.commentItem.pubdate)))]),s("van-button",{staticClass:"reply-btn",attrs:{size:"small",round:""},on:{click:function(e){return t.$toast("此功能暂未开放 ! ")}}},[t._v("点此回复")])],1)])],1)},L=[],S={props:["commentItem"],name:"CommentItem",data(){return{loading:!1}},methods:{async onCommentLike(t){this.loading=!0;try{if(t.is_liking)await E(t.com_id);else{const e={target:t.com_id};await T(e)}t.is_liking?t.like_count--:t.like_count++,this.$toast(t.is_liking?"取消点赞":"点赞成功"),t.is_liking=!this.commentItem.is_liking}catch(e){let t="发生未知错误 ! 请稍后重试";e.response&&401===e.response.status&&(t="认证过期或未登录 请登录 !",this.$router.push("/login")),this.$toast(t)}this.loading=!1}}},x=S,P=(0,d.Z)(x,I,L,!1,null,"6bcad8fa",null),A=P.exports,j={props:{source:{type:[Number,String,Object],required:!0},value:{type:[Number,String,Object]},data:{type:Array,default:()=>[]}},components:{CommentItem:A},name:"CommentList",data(){return{list:this.data,loading:!1,finished:!1,error:!1,offset:null,limit:10,total:0}},created(){this.onLoad()},updated(){this.$bus.$on("update-comment-list",(()=>{this.onLoad()}))},methods:{async onLoad(){try{const t={type:"a",source:this.source,offset:this.offset,limit:this.limit},{data:e}=await y(t),{results:s,total_count:a}=e.data;this.total=a,this.list.push(...s),this.$emit("input",this.total),this.loading=!1,s.length?this.offset=e.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}}}},G=j,O=(0,d.Z)(G,w,k,!1,null,"e615ed7c",null),q=O.exports,z=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment-post"},[s("van-field",{staticClass:"post-field",attrs:{type:"textarea",label:"",rows:"2",autosize:"",maxlength:"50",placeholder:"说点什么~","show-word-limit":"",autofocus:"true"},model:{value:t.msg,callback:function(e){t.msg="string"===typeof e?e.trim():e},expression:"msg"}}),s("van-button",{staticClass:"post-btn",attrs:{disabled:!t.msg.length,loading:t.loading},on:{click:t.onComment}},[t._v("发表评论")])],1)},N=[],F={props:["target"],name:"CommentPost",data(){return{msg:"",loading:!1}},methods:{async onComment(){this.loading=!0;try{const{data:t}=await Z({target:this.target,content:this.msg,art_id:null});this.$toast.success("发布成功"),this.$emit("postSuccess",t.data),this.msg=""}catch(t){let e="发生未知错误 ! 请稍后重试";t.response&&401===t.response.status&&(e="您尚未登录!",this.$router.push("/login")),this.$toast(e)}this.loading=!1}}},H=F,B=(0,d.Z)(H,z,N,!1,null,"04ce4c24",null),D=B.exports,M={props:["articleId"],name:"ArticleIndex",components:{FollowUser:l.Z,ArticleCollect:p,ArticleLike:C,CommentList:q,CommentPost:D},data(){return{article:{},loading:!0,errStatus:0,commentTotal:0,isPostShow:!1,commentList:[]}},methods:{async loadArticle(){this.loading=!0;try{const{data:t}=await(0,o.Vr)(this.articleId);this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404)}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),s=[];e.forEach(((t,e)=>{s.push(t.src),t.onclick=()=>{(0,n.Z)({images:s,startPosition:e})}}))},onCommentList(){const t=this.$refs.commentList.$children[0].$el.children[0].offsetTop;document.querySelector(".main-wrap").scrollTop=t},onPostSuccess(t){this.isPostShow=!1,this.commentList.unshift(t.new_obj)}},created(){this.loadArticle()}},U=M,Q=(0,d.Z)(U,a,i,!1,null,"3fe48b30",null),R=Q.exports},1767:function(t,e,s){s.d(e,{BH:function(){return c},Vr:function(){return o},_Y:function(){return n},cS:function(){return l},dE:function(){return r},fq:function(){return i}});var a=s(8029);const i=t=>(0,a.Z)({method:"GET",url:"/v1_0/articles",params:t}),o=t=>(0,a.Z)({method:"GET",url:`/v1_0/articles/${t}`}),n=t=>(0,a.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),l=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),r=t=>(0,a.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),c=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`})},5155:function(t,e,s){s.d(e,{Ci:function(){return l},Lj:function(){return m},Q6:function(){return o},R3:function(){return r},W9:function(){return d},X5:function(){return p},bG:function(){return n},dX:function(){return f},et:function(){return u},lQ:function(){return v},qi:function(){return h},x4:function(){return i},zM:function(){return c}});var a=s(8029);s(4901);const i=t=>(0,a.Z)({method:"POST",url:"/v1_0/authorizations",data:t}),o=t=>(0,a.Z)({method:"GET",url:`/v1_0/sms/codes/${t}`}),n=()=>(0,a.Z)({method:"GET",url:"/v1_0/user"}),l=()=>(0,a.Z)({method:"GET",url:"/v1_0/user/channels"}),r=t=>(0,a.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),c=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),u=()=>(0,a.Z)({method:"GET",url:"/v1_0/user/profile"}),m=t=>(0,a.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),d=t=>(0,a.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t}),h=()=>(0,a.Z)({method:"GET",url:"/v1_0/article/collections"}),p=()=>(0,a.Z)({method:"GET",url:"/v1_0/user/histories",params:{page:1,per_page:200}}),f=()=>(0,a.Z)({method:"GET",url:"/v1_0/user/followers",params:{page:1,per_page:200}}),v=()=>(0,a.Z)({method:"GET",url:"/v1_0/user/followings",params:{page:1,per_page:200}})}}]);