(self["webpackChunkheadline"]=self["webpackChunkheadline"]||[]).push([[711],{6711:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"search-container"},[r("van-nav-bar",{staticClass:"searchNav",attrs:{"right-text":"搜索","left-arrow":""},on:{"click-left":function(t){return e.$router.back()},"click-right":function(t){return e.onSearch(e.searchText)}}},[r("van-search",{attrs:{slot:"title",background:"#3395fc",placeholder:"请输入搜索关键词",shape:"round"},on:{focus:function(t){e.isShowSearchRes=!1},search:e.onSearch},slot:"title",model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),e.isShowSearchRes?r("search-result",{attrs:{"search-text":e.searchText}}):e.searchText?r("search-suggestion",{attrs:{searchText:e.searchText},on:{onSearch:e.onSearch}}):r("search-history",{ref:"searchHistory",on:{onSearch:e.onSearch}})],1)},a=[],s=(r(1539),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"search-history"},[r("van-cell",{staticClass:"hostory-container",attrs:{title:"搜索历史"}},[e.isShowDel?r("span",{on:{click:e.delAllHistory}},[e._v("全部删除")]):e._e(),e.isShowDel?r("span",{on:{click:function(t){e.isShowDel=!1,e.isShowClear=!1}}},[e._v("完成")]):r("van-icon",{attrs:{name:"delete-o"},on:{click:function(t){e.isShowDel=!0,e.isShowClear=!0}}})],1),r("div",{staticClass:"history-list"},e._l(e.historyAll,(function(t,n){return r("span",{key:n,staticClass:"history-item",on:{click:function(r){return e.clickSearchHistory(t,n)}}},[e._v(e._s(t)),e.isShowClear?r("van-icon",{attrs:{slot:"icon",name:"close"},slot:"icon"}):e._e()],1)})),0)],1)}),i=[],o=(r(561),r(1718)),c={name:"SearchHistory",data:function(){return{isShowDel:!1,historyAll:(0,o.rV)("his")||(0,o.LS)("his",[]),isShowClear:!1}},methods:{clickSearchHistory:function(e,t){this.isShowClear?(this.historyAll.splice(t,1),0===this.historyAll.length&&(this.isShowClear=!1,this.isShowDel=!1),(0,o.LS)("his",this.historyAll)):this.$emit("onSearch",e)},delAllHistory:function(){this.historyAll=[],this.isShowDel=!1,this.isShowClear=!1,(0,o.LS)("his",[])}}},l=c,h=r(1001),u=(0,h.Z)(l,s,i,!1,null,"fc220afc",null),f=u.exports,d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"search-suggestion"},[r("van-cell-group",e._l(e.searchSuggestions,(function(t,n){return r("van-cell",{key:n,attrs:{icon:"search"},on:{click:function(r){return e.$emit("onSearch",t)}}},[r("div",{attrs:{slot:"title"},domProps:{innerHTML:e._s(e.highlight(t))},slot:"title"})])})),1)],1)},p=[],S=r(2646),g=r(2381),v=(r(4603),r(8450),r(4916),r(8386),r(9714),r(5306),r(8757),r(8029)),m=function(e){return(0,v.Z)({method:"GET",url:"/v1_0/suggestion",params:{q:e}})},y=function(e){return(0,v.Z)({method:"GET",url:"/v1_0/search",params:e})},x=r(2009),w={props:["searchText"],name:"SearchSuggestion",data:function(){return{searchSuggestions:[]}},watch:{searchText:{handler:(0,x.debounce)((function(e){this.loadSearchSuggestions(e)}),300),immediate:!0}},methods:{loadSearchSuggestions:function(e){var t=this;return(0,g.Z)((0,S.Z)().mark((function r(){var n,a;return(0,S.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,m(e);case 3:n=r.sent,a=n.data,t.searchSuggestions=a.data.options,r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),t.$toast("发生未知错误 , 请稍后再试!");case 11:case"end":return r.stop()}}),r,null,[[0,8]])})))()},highlight:function(e){var t="<span class='active'>".concat(this.searchText,"</span>"),r=new RegExp(this.searchText,"gi");return e.replaceAll(r,t)}}},k=w,b=(0,h.Z)(k,d,p,!1,null,"3bbd1111",null),T=b.exports,_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"search-result"},[r("van-list",{attrs:{finished:e.finished,"finished-text":"没有更多了",error:e.error,"err-text":"加载失败 , 请重试!"},on:{"update:error":function(t){e.error=t},load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.list,(function(e,t){return r("van-cell",{key:t,attrs:{title:e.title,"is-link":"",to:{name:"article",params:{articleId:e.art_id}}}})})),1)],1)},A=[],C=r(3561),Z={props:{searchText:{type:String,required:!0}},name:"SearchResult",data:function(){return{list:[],loading:!1,finished:!1,page:1,error:!1}},methods:{onLoad:function(){var e=this;return(0,g.Z)((0,S.Z)().mark((function t(){var r,n,a,s,i;return(0,S.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={page:e.page,per_page:20,q:e.searchText},t.next=4,y(n);case 4:a=t.sent,s=a.data,i=s.data.results,(r=e.list).push.apply(r,(0,C.Z)(i)),e.loading=!1,i.length?e.page++:e.finished=!0,t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](0),e.error=!0,e.loading=!1;case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()}}},E=Z,$=(0,h.Z)(E,_,A,!1,null,"3c54bbdd",null),H=$.exports,D={name:"SearchIndex",components:{SearchHistory:f,SearchSuggestion:T,SearchResult:H},data:function(){return{searchText:"",isShowSearchRes:!1}},methods:{onSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.searchText;this.searchText=e,this.isShowSearchRes=!0;var t=(0,o.rV)("his"),r=t.some((function(t){return t===e}));r||(t.unshift(e),(0,o.LS)("his",t))}}},L=D,R=(0,h.Z)(L,n,a,!1,null,"704e6c48",null),I=R.exports},1038:function(e,t,r){var n=r(2109),a=r(8457),s=r(7072),i=!s((function(e){Array.from(e)}));n({target:"Array",stat:!0,forced:i},{from:a})},8757:function(e,t,r){"use strict";var n=r(2109),a=r(7854),s=r(6916),i=r(1702),o=r(4488),c=r(614),l=r(7850),h=r(1340),u=r(8173),f=r(4706),d=r(647),p=r(5112),S=r(1913),g=p("replace"),v=a.TypeError,m=i("".indexOf),y=i("".replace),x=i("".slice),w=Math.max,k=function(e,t,r){return r>e.length?-1:""===t?r:m(e,t,r)};n({target:"String",proto:!0},{replaceAll:function(e,t){var r,n,a,i,p,b,T,_,A,C=o(this),Z=0,E=0,$="";if(null!=e){if(r=l(e),r&&(n=h(o(f(e))),!~m(n,"g")))throw v("`.replaceAll` does not allow non-global regexes");if(a=u(e,g),a)return s(a,e,C,t);if(S&&r)return y(h(C),e,t)}i=h(C),p=h(e),b=c(t),b||(t=h(t)),T=p.length,_=w(1,T),Z=k(i,p,0);while(-1!==Z)A=b?h(t(p,Z,i)):d(p,i,Z,[],void 0,t),$+=x(i,E,Z)+A,E=Z+T,Z=k(i,p,Z+_);return E<i.length&&($+=x(i,E)),$}})},3561:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e){if(Array.isArray(e))return n(e)}r.d(t,{Z:function(){return c}});r(2526),r(1817),r(1539),r(2165),r(8783),r(3948),r(1038);function s(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}r(7042),r(8309),r(4916),r(7601);function i(e,t){if(e){if("string"===typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}r(1703);function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return a(e)||s(e)||i(e)||o()}}}]);