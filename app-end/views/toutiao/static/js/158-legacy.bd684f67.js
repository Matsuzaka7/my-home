(self["webpackChunkheadline"]=self["webpackChunkheadline"]||[]).push([[158],{8456:function(t,e,n){"use strict";n.d(e,{Z:function(){return d}});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-button",{staticClass:"follow-btn",attrs:{type:t.value?"default":"info",size:"small",round:"",loading:t.followLoading},on:{click:t.onFollow}},[t._t("default",(function(){return[t._v(" "+t._s(t.value?"已关注":"关注")+" ")]}))],2)},a=[],o=n(2646),i=n(2381),s=(n(9653),n(5155)),c={props:{value:{type:Boolean,required:!0},userId:{type:[Number,String,Object],required:!0}},name:"FollowUser",data:function(){return{followLoading:!1}},methods:{onFollow:function(){var t=this;return(0,i.Z)((0,o.Z)().mark((function e(){var n;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.followLoading=!0,e.prev=1,!t.value){e.next=8;break}return e.next=5,(0,s.zM)(t.userId);case 5:t.$toast("取消关注"),e.next=11;break;case 8:return e.next=10,(0,s.R3)(t.userId);case 10:t.$toast("关注成功");case 11:t.$emit("input",!t.value),e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](1),n="发生未知错误 ! 请稍后重试",e.t0.response&&400===e.t0.response.status?n="你不能关注你自己!":e.t0.response&&401===e.t0.response.status&&(n="您尚未登录!"),t.$toast(n);case 19:t.followLoading=!1;case 20:case"end":return e.stop()}}),e,null,[[1,14]])})))()}}},l=c,u=n(1001),m=(0,u.Z)(l,r,a,!1,null,"3bd8d9be",null),d=m.exports},1158:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Y}});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"article-container"},[n("van-nav-bar",{staticClass:"articleNav",attrs:{title:"文章详情","left-arrow":""},on:{"click-left":function(e){return t.$router.back()}}}),n("div",{staticClass:"main-wrap"},[t.loading?n("div",{staticClass:"loading-wrap"},[n("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("疯狂加载中...")])],1):t.article.title?n("div",{staticClass:"article-detail"},[n("h4",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),n("van-cell",{ref:"author",staticClass:"author user-cell",attrs:{center:"",border:!1}},[n("div",{staticClass:"base-info"},[n("van-image",{attrs:{round:"",width:"1rem",height:"1rem",fit:"cover",src:t.article.aut_photo}}),n("div",{staticClass:"text"},[n("p",{staticClass:"name"},[t._v(t._s(t.article.aut_name))]),n("p",{staticClass:"time"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]),n("FollowUser",{staticClass:"follow-btn",attrs:{userId:t.article.aut_id},model:{value:t.article.is_followed,callback:function(e){t.$set(t.article,"is_followed",e)},expression:"article.is_followed"}})],1)]),n("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),n("CommentList",{ref:"commentList",attrs:{source:t.article.art_id,data:t.commentList},model:{value:t.commentTotal,callback:function(e){t.commentTotal=e},expression:"commentTotal"}}),n("div",{staticClass:"article-footer"},[n("van-button",{staticClass:"onComment",attrs:{icon:"edit",type:"default"},on:{click:function(e){t.isPostShow=!0,t.onCommentList()}}},[t._v("写评论")]),n("van-icon",{attrs:{name:"comment-o",info:t.commentTotal,color:"#777"},on:{click:t.onCommentList}}),n("ArticleCollect",{staticClass:"btn-item",attrs:{articleId:t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),n("ArticleLike",{staticClass:"btn-item",attrs:{articleId:t.article.art_id},model:{value:t.article.attitude,callback:function(e){t.$set(t.article,"attitude",e)},expression:"article.attitude"}}),n("van-icon",{attrs:{name:"share-o",color:"#777777"},on:{click:function(e){return t.$toast("此功能暂未开放 ! ")}}})],1)],1):404===t.errStatus?n("div",{staticClass:"error-wrap"},[n("van-icon",{attrs:{name:"failure"}}),n("p",{staticClass:"text"},[t._v("该资源不存在或已删除!")])],1):n("div",{staticClass:"error-wrap"},[n("van-icon",{attrs:{name:"failure"}}),n("p",{staticClass:"text"},[t._v("内容加载失败!")]),n("van-button",{attrs:{type:"info"},on:{click:t.loadArticle}},[t._v("点击重试")])],1),n("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[n("CommentPost",{attrs:{target:t.article.art_id},on:{postSuccess:t.onPostSuccess}})],1)],1)],1)},a=[],o=n(2646),i=n(2381),s=(n(1539),n(4747),n(1767)),c=n(3984),l=n(8456),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-button",{class:{collected:t.value},attrs:{loading:t.loading,icon:t.value?"star":"star-o"},on:{click:t.onCollect}})},m=[],d=(n(9653),{props:{value:{type:Boolean,required:!0},articleId:{type:[Number,String,Object],required:!0}},name:"ArticleCollect",data:function(){return{loading:!1}},methods:{onCollect:function(){var t=this;return(0,i.Z)((0,o.Z)().mark((function e(){var n;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loading=!0,e.prev=1,!t.value){e.next=7;break}return e.next=5,(0,s.cS)(t.articleId);case 5:e.next=9;break;case 7:return e.next=9,(0,s._Y)(t.articleId);case 9:t.$emit("input",!t.value),t.$toast(t.value?"取消收藏":"收藏成功"),e.next=18;break;case 13:e.prev=13,e.t0=e["catch"](1),n="发生未知错误 ! 请稍后重试",e.t0.response&&401===e.t0.response.status&&(n="认证过期或未登录 请登录 !",t.$router.push("/login")),t.$toast(n);case 18:t.loading=!1;case 19:case"end":return e.stop()}}),e,null,[[1,13]])})))()}}}),f=d,p=n(1001),v=(0,p.Z)(f,u,m,!1,null,"6cf0c2fc",null),h=v.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-button",{class:{liked:1===t.value},attrs:{icon:1===t.value?"good-job":"good-job-o",loading:t.loading},on:{click:t.onLike}})},g=[],b={props:{value:{type:[Number,String,Object],required:!0},articleId:{type:[Number,String,Object],required:!0}},name:"ArticleLike",data:function(){return{loading:!1}},methods:{onLike:function(){var t=this;return(0,i.Z)((0,o.Z)().mark((function e(){var n;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loading=!0,e.prev=1,1!==t.value){e.next=7;break}return e.next=5,(0,s.BH)(t.articleId);case 5:e.next=9;break;case 7:return e.next=9,(0,s.dE)(t.articleId);case 9:t.$emit("input",1===t.value?-1:1),t.$toast(1!==t.value?"点赞成功":"取消点赞"),e.next=18;break;case 13:e.prev=13,e.t0=e["catch"](1),n="发生未知错误 ! 请稍后重试",e.t0.response&&401===e.t0.response.status&&(n="认证过期或未登录 请登录 !",t.$router.push("/login")),t.$toast(n);case 18:t.loading=!1;case 19:case"end":return e.stop()}}),e,null,[[1,13]])})))()}}},k=b,w=(0,p.Z)(k,_,g,!1,null,"3dcfe18e",null),C=w.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[n("h4",[t._v("全部评论 ("+t._s(t.total)+")")]),t._l(t.data,(function(t,e){return n("CommentItem",{key:e,attrs:{commentItem:t}})}))],2)],1)},Z=[],$=n(3561),y=n(8029),I=function(t){return(0,y.Z)({method:"GET",url:"/v1_0/comments",params:t})},T=function(t){return(0,y.Z)({method:"POST",url:"/v1_0/comment/likings",data:t})},E=function(t){return(0,y.Z)({method:"DELETE",url:"/v1_0/comment/likings/".concat(t)})},S=function(t){return(0,y.Z)({method:"POST",url:"/v1_0/comments",data:t})},L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-cell",{staticClass:"comment-item"},[n("van-image",{staticClass:"avtar",attrs:{slot:"icon",src:t.commentItem.aut_photo,round:"",fit:"cover"},slot:"icon"}),n("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[n("div",{staticClass:"user-name"},[t._v(t._s(t.commentItem.aut_name))]),n("van-button",{staticClass:"like-btn",class:{liked:t.commentItem.is_liking},attrs:{size:"small",loading:t.loading,icon:t.commentItem.is_liking?"good-job":"good-job-o"},on:{click:function(e){return t.onCommentLike(t.commentItem)}}},[t._v(t._s(t.commentItem.like_count>0?t.commentItem.like_count:"赞"))])],1),n("div",{staticClass:"box",attrs:{slot:"label"},slot:"label"},[n("p",{staticClass:"comment-content"},[t._v(t._s(t.commentItem.content))]),n("div",{staticClass:"bottom-info"},[n("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.commentItem.pubdate)))]),n("van-button",{staticClass:"reply-btn",attrs:{size:"small",round:""},on:{click:function(e){return t.$toast("此功能暂未开放 ! ")}}},[t._v("点此回复")])],1)])],1)},A=[],P={props:["commentItem"],name:"CommentItem",data:function(){return{loading:!1}},methods:{onCommentLike:function(t){var e=this;return(0,i.Z)((0,o.Z)().mark((function n(){var r,a;return(0,o.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.loading=!0,n.prev=1,!t.is_liking){n.next=7;break}return n.next=5,E(t.com_id);case 5:n.next=10;break;case 7:return r={target:t.com_id},n.next=10,T(r);case 10:t.is_liking?t.like_count--:t.like_count++,e.$toast(t.is_liking?"取消点赞":"点赞成功"),t.is_liking=!e.commentItem.is_liking,n.next=20;break;case 15:n.prev=15,n.t0=n["catch"](1),a="发生未知错误 ! 请稍后重试",n.t0.response&&401===n.t0.response.status&&(a="认证过期或未登录 请登录 !",e.$router.push("/login")),e.$toast(a);case 20:e.loading=!1;case 21:case"end":return n.stop()}}),n,null,[[1,15]])})))()}}},j=P,O=(0,p.Z)(j,L,A,!1,null,"6bcad8fa",null),G=O.exports,q={props:{source:{type:[Number,String,Object],required:!0},value:{type:[Number,String,Object]},data:{type:Array,default:function(){return[]}}},components:{CommentItem:G},name:"CommentList",data:function(){return{list:this.data,loading:!1,finished:!1,error:!1,offset:null,limit:10,total:0}},created:function(){this.onLoad()},updated:function(){var t=this;this.$bus.$on("update-comment-list",(function(){t.onLoad()}))},methods:{onLoad:function(){var t=this;return(0,i.Z)((0,o.Z)().mark((function e(){var n,r,a,i,s,c,l;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r={type:"a",source:t.source,offset:t.offset,limit:t.limit},e.next=4,I(r);case 4:a=e.sent,i=a.data,s=i.data,c=s.results,l=s.total_count,t.total=l,(n=t.list).push.apply(n,(0,$.Z)(c)),t.$emit("input",t.total),t.loading=!1,c.length?t.offset=i.data.last_id:t.finished=!0,e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](0),t.error=!0,t.loading=!1;case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))()}}},z=q,N=(0,p.Z)(z,x,Z,!1,null,"e615ed7c",null),F=N.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-post"},[n("van-field",{staticClass:"post-field",attrs:{type:"textarea",label:"",rows:"2",autosize:"",maxlength:"50",placeholder:"说点什么~","show-word-limit":"",autofocus:"true"},model:{value:t.msg,callback:function(e){t.msg="string"===typeof e?e.trim():e},expression:"msg"}}),n("van-button",{staticClass:"post-btn",attrs:{disabled:!t.msg.length,loading:t.loading},on:{click:t.onComment}},[t._v("发表评论")])],1)},B=[],D={props:["target"],name:"CommentPost",data:function(){return{msg:"",loading:!1}},methods:{onComment:function(){var t=this;return(0,i.Z)((0,o.Z)().mark((function e(){var n,r,a;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,S({target:t.target,content:t.msg,art_id:null});case 4:n=e.sent,r=n.data,t.$toast.success("发布成功"),t.$emit("postSuccess",r.data),t.msg="",e.next=16;break;case 11:e.prev=11,e.t0=e["catch"](1),a="发生未知错误 ! 请稍后重试",e.t0.response&&401===e.t0.response.status&&(a="您尚未登录!",t.$router.push("/login")),t.$toast(a);case 16:t.loading=!1;case 17:case"end":return e.stop()}}),e,null,[[1,11]])})))()}}},M=D,U=(0,p.Z)(M,H,B,!1,null,"04ce4c24",null),Q=U.exports,R={props:["articleId"],name:"ArticleIndex",components:{FollowUser:l.Z,ArticleCollect:h,ArticleLike:C,CommentList:F,CommentPost:Q},data:function(){return{article:{},loading:!0,errStatus:0,commentTotal:0,isPostShow:!1,commentList:[]}},methods:{loadArticle:function(){var t=this;return(0,i.Z)((0,o.Z)().mark((function e(){var n,r;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,(0,s.Vr)(t.articleId);case 4:n=e.sent,r=n.data,t.article=r.data,setTimeout((function(){t.previewImage()}),0),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](1),e.t0.response&&404===e.t0.response.status&&(t.errStatus=404);case 13:t.loading=!1;case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))()},previewImage:function(){var t=this.$refs["article-content"],e=t.querySelectorAll("img"),n=[];e.forEach((function(t,e){n.push(t.src),t.onclick=function(){(0,c.Z)({images:n,startPosition:e})}}))},onCommentList:function(){var t=this.$refs.commentList.$children[0].$el.children[0].offsetTop;document.querySelector(".main-wrap").scrollTop=t},onPostSuccess:function(t){this.isPostShow=!1,this.commentList.unshift(t.new_obj)}},created:function(){this.loadArticle()}},V=R,X=(0,p.Z)(V,r,a,!1,null,"3fe48b30",null),Y=X.exports},1038:function(t,e,n){var r=n(2109),a=n(8457),o=n(7072),i=!o((function(t){Array.from(t)}));r({target:"Array",stat:!0,forced:i},{from:a})},1767:function(t,e,n){"use strict";n.d(e,{BH:function(){return l},Vr:function(){return o},_Y:function(){return i},cS:function(){return s},dE:function(){return c},fq:function(){return a}});var r=n(8029),a=function(t){return(0,r.Z)({method:"GET",url:"/v1_0/articles",params:t})},o=function(t){return(0,r.Z)({method:"GET",url:"/v1_0/articles/".concat(t)})},i=function(t){return(0,r.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}})},s=function(t){return(0,r.Z)({method:"DELETE",url:"/v1_0/article/collections/".concat(t)})},c=function(t){return(0,r.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}})},l=function(t){return(0,r.Z)({method:"DELETE",url:"/v1_0/article/likings/".concat(t)})}},5155:function(t,e,n){"use strict";n.d(e,{Ci:function(){return s},Lj:function(){return m},Q6:function(){return o},R3:function(){return c},W9:function(){return d},X5:function(){return p},bG:function(){return i},dX:function(){return v},et:function(){return u},lQ:function(){return h},qi:function(){return f},x4:function(){return a},zM:function(){return l}});var r=n(8029),a=(n(4901),function(t){return(0,r.Z)({method:"POST",url:"/v1_0/authorizations",data:t})}),o=function(t){return(0,r.Z)({method:"GET",url:"/v1_0/sms/codes/".concat(t)})},i=function(){return(0,r.Z)({method:"GET",url:"/v1_0/user"})},s=function(){return(0,r.Z)({method:"GET",url:"/v1_0/user/channels"})},c=function(t){return(0,r.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}})},l=function(t){return(0,r.Z)({method:"DELETE",url:"/v1_0/user/followings/".concat(t)})},u=function(){return(0,r.Z)({method:"GET",url:"/v1_0/user/profile"})},m=function(t){return(0,r.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t})},d=function(t){return(0,r.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t})},f=function(){return(0,r.Z)({method:"GET",url:"/v1_0/article/collections"})},p=function(){return(0,r.Z)({method:"GET",url:"/v1_0/user/histories",params:{page:1,per_page:200}})},v=function(){return(0,r.Z)({method:"GET",url:"/v1_0/user/followers",params:{page:1,per_page:200}})},h=function(){return(0,r.Z)({method:"GET",url:"/v1_0/user/followings",params:{page:1,per_page:200}})}},3561:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t){if(Array.isArray(t))return r(t)}n.d(e,{Z:function(){return c}});n(2526),n(1817),n(1539),n(2165),n(8783),n(3948),n(1038);function o(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n(7042),n(8309),n(4916),n(7601);function i(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}n(1703);function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return a(t)||o(t)||i(t)||s()}}}]);